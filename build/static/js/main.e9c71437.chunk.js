(this.webpackJsonpfile_trans=this.webpackJsonpfile_trans||[]).push([[0],{13:function(e,t,a){e.exports=a(22)},18:function(e,t,a){},19:function(e,t,a){},21:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(6),o=a.n(s);a(18),a(7),a(19);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=a(4),c=a.n(l),r=a(8),u=a(1),d=a(2),p=a(9),f=a(10),h=a(3),b=a(12),m=a(11),O="file_uploading",v="file_error",j="file_before_upload",g="file_hashing",y="file_success",k=(a(21),function(e){Object(b.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this)).state={files:[],status:"init",fileStatus:[],fileToUpload:0},n.addFile=n.addFile.bind(Object(h.a)(n)),n.uploadAll=n.uploadAll.bind(Object(h.a)(n)),n.uploadOne=n.uploadOne.bind(Object(h.a)(n)),n.pauseOrContinue=n.pauseOrContinue.bind(Object(h.a)(n)),n.cancel=n.cancel.bind(Object(h.a)(n)),n.divideAndUploadSlice=n.divideAndUploadSlice.bind(Object(h.a)(n)),n.uploadFinish=n.uploadFinish.bind(Object(h.a)(n)),n.render=n.render.bind(Object(h.a)(n)),n}return Object(f.a)(a,[{key:"addFile",value:function(e){for(var t=e.target.files,a=Object(d.a)(this.state.files),n=Object(d.a)(this.state.fileStatus),i=0;i<t.length;++i)a.push(t[i]),n.push({status:j,percentage:0});this.setState(Object(u.a)(Object(u.a)({},this.state),{},{files:Object(d.a)(a),fileStatus:Object(d.a)(n),fileToUpload:this.state.fileToUpload+a.length})),e.target.value=""}},{key:"uploadAll",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t,a=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,new Promise((function(e){a.setState(Object(u.a)(Object(u.a)({},a.state),{},{status:"uploading"}),(function(){e()}))}));case 3:return e.next=5,Promise.all(t.state.files.map((function(e,a){return t.uploadOne(e,a)})));case 5:if(!(this.state.fileToUpload>0)){e.next=11;break}if("pausing"!=this.state.status){e.next=8;break}return e.abrupt("return");case 8:this.setState(Object(u.a)(Object(u.a)({},this.state),{},{status:"error"})),e.next=13;break;case 11:this.setState(Object(u.a)(Object(u.a)({},this.state),{},{status:"success",files:[],fileStatus:[]})),setTimeout((function(){t.setState(Object(u.a)(Object(u.a)({},t.state),{},{status:"init"}))}),3e3);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadOne",value:function(e,t){var a=this;return new Promise((function(n){var i=function(){var e=Object(d.a)(a.state.fileStatus);e[t].status=v,a.setState(Object(u.a)(Object(u.a)({},a.state),{},{fileStatus:Object(d.a)(e)}),(function(){n("err")}))},s=function(){var e=Object(d.a)(a.state.fileStatus);e[t].status=y,a.setState(Object(u.a)(Object(u.a)({},a.state),{},{fileStatus:Object(d.a)(e),fileToUpload:a.state.fileToUpload-1}),(function(){n("ok")}))},o=function(e){var n=Object(d.a)(a.state.fileStatus);n[t].status=e,a.setState(Object(u.a)(Object(u.a)({},a.state),{},{fileStatus:Object(d.a)(n)}))};o(g);var l=new FileReader;l.onload=function(l){var c=new Worker("/hash.js");c.onmessage=function(l){if(l.data.err||!l.data.hash)return console.log(l.data.err||"Worker data error"),void i();o(O);var c=l.data.hash,r=encodeURIComponent(c);fetch("/upload?hash="+r+"&sliceNum="+Math.ceil(e.size/1048576)).then((function(o){o.json().then((function(o){o.needUpload?a.divideAndUploadSlice(e,c,t,o.needUploadIndex).then((function(e){e&&("pause"==e?n("pause"):s())}),(function(e){e&&i()})).catch((function(e){e&&i()})):s()})).catch((function(e){console.log(e),i()}))})).catch((function(e){console.log(e),i()}))},c.postMessage({file:l.target.result})},l.readAsArrayBuffer(e)}))}},{key:"divideAndUploadSlice",value:function(e,t,a,n){var i=this;return new Promise((function(s,o){var l=!1;if(e.size<1048576){var c=new FormData;t&&c.append("hash",t),c.append("name",e.name),c.append("file",e);i.postData(c,"/upload","multipart/form-data").then((function(e){200!=e.status?o(e.status):s("ok")})).catch((function(e){e&&o(e)}))}else!function(){for(var c=[],r=0,p=0,f=i;r<e.size;){var h=e.slice(r,r+1048576);r+=1048576,c.push(h)}for(var b=0;b<c.length;++b){if("pausing"==f.state.status){s("pause");break}if(!n||-1!=n.indexOf(b)){var m=new FormData;m.append("hash",t),m.append("index",b),m.append("name",e.name),m.append("file",c[b]),i.postData(m,"/upload","multipart/form-data").then((function(i){200!=i.status&&(l=!0),(++p==c.length||n&&p==n.length)&&(l?o("upload error"):f.uploadFinish({hash:t,name:e.name},(function(){o("err")}),(function(){s("ok")})));var r=Object(d.a)(f.state.fileStatus);r[a].percentage=n?(p/n.length*100).toFixed(2):(p/c.length*100).toFixed(2),f.setState(Object(u.a)(Object(u.a)({},f.state),{},{fileStatus:Object(d.a)(r)}))})).catch((function(e){e&&(l=!0)}))}}}()}))}},{key:"uploadFinish",value:function(e,t,a){var n=new FormData;n.append("finish",!0);Object.keys(e).forEach((function(t){n.append(t,e[t])})),this.postData(n,"/upload","multipart/form-data").then((function(e){200==e.status?a():t()})).catch((function(e){e&&t()}))}},{key:"postData",value:function(e,t,a){return"multipart/form-data"==a?fetch(t,{method:"POST",body:e}):fetch(t,{method:"POST",body:e,headers:{contentType:a}})}},{key:"pauseOrContinue",value:function(){"uploading"!=this.state.status?"pausing"==this.state.status&&this.uploadAll():this.setState(Object(u.a)(Object(u.a)({},this.state),{},{status:"pausing"}))}},{key:"cancel",value:function(){this.setState(Object(u.a)(Object(u.a)({},this.state),{},{status:"pausing"}));var e=this;setTimeout((function(){e.setState({files:[],status:"init",fileStatus:[],fileToUpload:0})}),0)}},{key:"render",value:function(){var e=this,t=this.state.status,a=!("pausing"==t||"uploading"==t),n="uploading"==t||"pausing"==t,s={display:this.state.files.length>0?"inline-block":"none"};return i.a.createElement("div",{id:"container"},i.a.createElement("a",null,i.a.createElement("input",{title:"choose file",type:"file",onChange:this.addFile,multiple:!0,maxLength:"9"}),"choose file"),i.a.createElement("br",null),i.a.createElement("button",{id:"upload-btn",style:s,onClick:a?this.uploadAll:void 0},"error"==t?"retry":"upload"),i.a.createElement("button",{id:"pause-btn",style:s,onClick:n?this.pauseOrContinue:void 0},"pausing"==t?"continue":"pause"),i.a.createElement("button",{id:"cancel-btn",style:s,onClick:this.cancel},"cancel"),i.a.createElement("br",null),i.a.createElement("ul",null,this.state.files.map((function(t,a){var n=e.state.fileStatus[a].status,s=n==v||n==O;return i.a.createElement("li",{className:"fileList",key:a},i.a.createElement("p",{title:t.name},t.name),i.a.createElement("div",{className:"processing",style:{display:n==g?"inline-block":"none"}}),i.a.createElement("div",{className:"bar",style:{display:s?"inline-block":"none"}},i.a.createElement("div",{className:"bar-inner",style:{width:(e.state.fileStatus[a].percentage||0)+"%",backgroundColor:n==v?"red":"green"}})),i.a.createElement("p",{id:"file-finish-p",style:{display:n==y?"inline-block":"none"}},"finish"),i.a.createElement("p",{id:"file-error-p",style:{display:n==v?"inline-block":"none"}},"ERROR"))}))),i.a.createElement("p",{id:"error-p",title:"Something is wrong, please retry.",style:{display:"error"==this.state.status?"inline-block":"none"}},"Something is wrong, please retry."),i.a.createElement("p",{id:"finish-p",style:{display:"success"==this.state.status?"inline-block":"none"}},"Upload finish"))}}]),a}(n.Component));o.a.render(i.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"}},[[13,1,2]]]);
//# sourceMappingURL=main.e9c71437.chunk.js.map